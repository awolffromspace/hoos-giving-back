{% extends 'donations/base.html' %}
{% block content %}

<div class="wrapper">
  {% if user.is_authenticated %}
    <form action="/donations/donate/" method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <p><b>Donate</b></p>
      <label for="charity1">The Trevor Project:</label>
      <p>The ultimate goal of The Trevor Project is to end suicide among LGBTQ people under 25 by providing them with counseling and education. It offers young people support with trained counselors via phone, text, and online chat. Every $1 donated allows people to get one more minute of counseling.</p>
      <div class="range-wrap">
        <input type="range" class="range" link-to="charity1" min="0.00" max="100.00" step="0.01" value="0.00">
        <output class="bubble"></output>
      </div>
      <br><br>
      <b>$</b><input type="text" id="charity1"><br><br>
      <label for="charity2">The National Immigration Law Center:</label>
      <p>This nonprofit has defended the rights of low-income immigrants in the US since 1979. It works to provide immigrants access to health care and fights unconstitutional immigration policy. The nonprofit also works to educate the public on the impact new laws would have on this marginalized group.</p>
      <div class="range-wrap">
        <input type="range" class="range" link-to="charity2" min="0.00" max="100.00" step="0.01" value="0.00">
        <output class="bubble"></output>
      </div>
      <br><br>
      <b>$</b><input type="text" id="charity2"><br><br>
      <label for="charity3">Human Rights Watch:</label>
      <p>Defending the rights of people across the globe is no small task, but the organization Human Rights Watch has been doing just this since 1978. About 400 journalists, attorneys, country experts, and many others work to publish non-partisan and independent reports every year on human rights conditions around the world.</p>
      <div class="range-wrap">
        <input type="range" class="range" link-to="charity3" min="0.00" max="100.00" step="0.01" value="0.00">
        <output class="bubble"></output>
      </div>
      <br><br>
      <b>$</b><input type="text" id="charity3"><br><br>
      <label for="charity4">The Global Fund for Women:</label>
      <p>The Global Fund for Women proudly calls itself and its supporters champions for equality. From setting up the first women’s fund in Nepal to funding secret schools in Afghanistan, this bold organization strives to empower women and girls around the world and ensure they are granted basic human rights.</p>
      <div class="range-wrap">
        <input type="range" class="range" link-to="charity4" min="0.00" max="100.00" step="0.01" value="0.00">
        <output class="bubble"></output>
      </div>
      <br><br>
      <b>$</b><input type="text" id="charity4"><br><br>
      <label for="charity5">Charity Water:</label>
      <p>According to charity: water, one in 10 people don’t have access to clean drinking water. The organization hopes to change these stats by bringing clean and safe drinking water to developing countries. It has already funded over 29,000 water projects around the world.</p>
      <div class="range-wrap">
        <input type="range" class="range" link-to="charity5" min="0.00" max="100.00" step="0.01" value="0.00">
        <output class="bubble"></output>
      </div>
      <br><br>
      <b>$</b><input type="text" id="charity5"><br><br>
      <label for="charity6">Mental Health America:</label>
      <p>Founded in 1909, Mental Health America helps Americans understand, prevent, and treat mental health issues that can interfere with their overall wellness and ability to live a healthy life. They also focus on educating Americans about mental health issues through their online hub of information and tools.</p>
      <div class="range-wrap">
        <input type="range" class="range" link-to="charity6" min="0.00" max="100.00" step="0.01" value="0.00">
        <output class="bubble"></output>
      </div>
      <br><br>
      <b>$</b><input type="text" id="charity6"><br><br>
      <input type="hidden" id="id_money_total">
      <input type="submit" value="Submit" class="btn btn-primary" onclick="joinSplits();">
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script>
    const allRanges = document.querySelectorAll(".range-wrap");
    allRanges.forEach(wrap => {
      const range = wrap.querySelector(".range");
      const bubble = wrap.querySelector(".bubble");

      range.addEventListener("input", () => {
        setBubble(range, bubble);
      });
      setBubble(range, bubble);
    });

    function setBubble(range, bubble) {
      const val = range.value;
      const min = range.min ? range.min : 0;
      const max = range.max ? range.max : 100;
      const newVal = Number(((val - min) * 100) / (max - min));
      bubble.innerHTML = val;
      bubble.style.left = `calc(${newVal}% + (${8 - newVal * 0.15}px))`;
    }

    function joinSplits() {
      var index = 1;
      var charity = "charity" + index.toString();
      var money_total = 0;
      var money_splits = "";
      while (document.getElementById(charity) !== null) {
        money_total += document.getElementById(charity).value;
        money_splits += document.getElementById(charity).value + ",";
        $(charity).prop('disabled', true);
        index++;
        charity = "charity" + index.toString();
      }
      document.getElementById('id_money_total').value = money_total;
      document.getElementById('id_money_splits').value = money_splits;
    }

$(function() {
  $('input').filter( function(){return this.type == 'range' } ).each(function(){  
    var $slider = $(this),
      $text_box = $('#'+$(this).attr('link-to'));
    
    $text_box.val(this.value);
    
    $slider.change(function(){
      $text_box.val(this.value);
    });
    
    $text_box.change(function(){
      $slider.val($text_box.val());
      setBubble(this, bubble);
    });

  });
});
    </script>
  {% else %}
    <p>You aren't logged in.</p>
  {% endif %}
</div>

{% endblock content %}